<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <!-- Basic Page Needs –––––––––––––– -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>German Productions</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- Mobile Specific Metas –––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT –––––––––––––––––––––––––––––––––––––––––––––––––– -->
 <link href='https://fonts.googleapis.com/css?family=Abel|Oswald|Montserrat|Fredoka+One|Candal|Lobster|Nova+Script|Pacifico' rel='stylesheet' type='text/css'>
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  <!-- CSS  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/magnificpopup.css">
  <link rel="stylesheet" href="../node_modules/animate.css/animate.min.css">


 <!-- ANGULAR LIBRARIES -->
 <!--<script src="js/lib/angular/angular.min.js"></script>-->
 <script src="../node_modules/angular/angular.js"></script>
 <!--<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>-->
 <!--<script src="js/lib/angular/angular-animate.min.js"></script>-->


 <!-- FIREBASE AND ANGULARFIRE -->
 <script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
 <script src="https://cdn.firebase.com/libs/angularfire/1.1.3/angularfire.min.js"></script>

  <!-- scripts -->
  <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>-->

</head>
<body ng-app="myApp">


<nav class="navbar navbar-default">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--<a class="navbar-brand" href="#">Brand</a>-->
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li class="active"><a href="#/home">Home<span class="sr-only">(current)</span></a></li>
                <li><a href="#/control">Control</a></li>
                <!--<li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">Separated link</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">One more separated link</a></li>
                    </ul>
                </li>-->
            </ul>
            <!--<form class="navbar-form navbar-left">-->
      <!--<div class="form-group">
                    <input type="text" class="form-control" placeholder="Search">
                </div>-->
                <!--<button type="submit" class="btn btn-default">Submit</button>-->
            <!--</form>-->
     <!--       <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Link</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">Separated link</a></li>
                    </ul>
                </li>
            </ul>-->
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>



<!-- angular view --->
<ui-view></ui-view>
<!-- ---------------->


<!-- SHOW THIS DIV BASED ON THE CURRENT STATE - IN THIS CASE ONLY SHOW ON THE CONTROL STATE -->
<div class="container">
    <form>
<div ng-controller="dbController" ng-show="uiRouterState.current.name == 'control'">
    <progress value="0" max="100" id="uploader">0%</progress>
    <input type="file" value="upload" id="fileButton">
    <h4>File URL:</h4>
    <span id="linkurl"></span>
    <br>
    <span id="linkbox"></span>
</div>
    </form>
</div>


<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCTA1A8ndRa_5tRH5-Tji-vG-jS2RVGf1s",
        authDomain: "germanproductions.firebaseapp.com",
        databaseURL: "https://germanproductions.firebaseio.com",
        storageBucket: "firebase-germanproductions.appspot.com",
        messagingSenderId: "33626558030"
    };
    firebase.initializeApp(config);

    var uploader = document.getElementById('uploader');
    var fileButton = document.getElementById('fileButton');

    console.log('got buttons');

    fileButton.addEventListener('change', function (e) {
        console.log('getting file..');
        // Get file
        var file = e.target.files[0];
        console.log('got file');
        var metadata = {
            'contentType': file.type
        };
        console.log('content type');

        // Create storage ref
        var storageRef = firebase.storage().ref('pictures/' + file.name);

        //storageRef.child('pictures/' + file.name);

        storageRef.child('pictures/' + file.name).put(file, metadata).then(function(snapshot) {
            console.log('Uploaded', snapshot.totalBytes, 'bytes.');
            console.log(snapshot.metadata);
            var url = snapshot.metadata.downloadURLs[0];
            console.log('File available at', url);
            document.getElementById('linkurl').innerHTML = '<span>URL: ' + url + ' </span>';
            document.getElementById('linkbox').innerHTML = '<img src="' +  url + '">';
            // <img src="smiley.gif" alt="Smiley face" height="42" width="42">


            console.log('add link to database...');
            // store url in database to then retrieve and display in home.html
            var linkRef = new Firebase('https://germanproductions.firebaseio.com/' + '/link');
            var list = $firebaseArray(linkRef);
            list.$add({ imageURL: url }).then(function (ref) {
                var id = ref.key();
                console.log("added record with id" + id);
                list.$indexFor(id);
            })


        }).catch(function(error) {
            console.error('Upload failed:', error);
        });


        // Upload File
        var task = storageRef.put(file);

        // Update the progress bar
        task.on('state_changed',
            function progress(snapshot) {
                var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                uploader.value = percentage;
                console.log('im alive..');
            },
            function error(err) {
                console.log('Error');
            },
            function complete() {
                console.log('Completed uploading file');
            }
        );
    });

</script>


<script
        src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
        crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="js/jq.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.3.2/angular-ui-router.js"></script>
<script src="js/myapp.js"></script>
<script src="js/services/databaseService.js"></script>


<!--<script src="js/controllers/dbController.js"></script>-->
<!--<script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-database.js"></script>-->
</body>
</html>
